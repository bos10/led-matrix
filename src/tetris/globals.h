#include <ESP8266WiFi.h>
#include <ESP8266WebServer.h>
#include "WebSocketsServer.h"

// Global variables
extern const char* ssid = "tembusu_tetris";
extern const char* password = "";
extern const uint8_t wsPort = 81;
extern IPAddress apIP(192, 168, 4, 1);
extern ESP8266WebServer server(80);
extern WebSocketsServer webSocket = WebSocketsServer(wsPort);

extern int GAME_SPEED = 1.5;
extern int score = 0;

extern int curX; //current X-location of falling piece
extern int curY; //current X-location of falling piece
extern int curPiece; //id of current piece (pieces[curPiece] returns 4x4 piece array)
extern int nextPiece = -1;

extern char Score[9][14] = 
                     {{'-','-','-','-','-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-','-','-','-','-'},
                      {'-','w','w','w','-','w','w','w','-','w','w','w','-','-'},
                      {'-','w','-','w','-','w','-','w','-','w','-','w','-','-'},
                      {'-','w','-','w','-','w','-','w','-','w','-','w','-','-'},
                      {'-','w','-','w','-','w','-','w','-','w','-','w','-','-'},
                      {'-','w','w','w','-','w','w','w','-','w','w','w','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-','-','-','-','-'}};

extern char numbers[10][5][3] = 
                    {{{'w','w','w'},
                      {'w','-','w'},
                      {'w','-','w'},
                      {'w','-','w'},
                      {'w','w','w'}},

                     {{'-','w','-'},
                      {'-','w','-'},
                      {'-','w','-'},
                      {'-','w','-'},
                      {'-','w','-'}},

                     {{'w','w','w'},
                      {'-','-','w'},
                      {'w','w','w'},
                      {'w','-','-'},
                      {'w','w','w'}},

                     {{'w','w','w'},
                      {'-','-','w'},
                      {'w','w','w'},
                      {'-','-','w'},
                      {'w','w','w'}},

                     {{'w','-','w'},
                      {'w','-','w'},
                      {'w','w','w'},
                      {'-','-','w'},
                      {'-','-','w'}},

                     {{'w','w','w'},
                      {'w','-','-'},
                      {'w','w','w'},
                      {'-','-','w'},
                      {'w','w','w'}},

                     {{'w','w','w'},
                      {'w','-','-'},
                      {'w','w','w'},
                      {'w','-','w'},
                      {'w','w','w'}},

                     {{'w','w','w'},
                      {'-','-','w'},
                      {'-','-','w'},
                      {'-','-','w'},
                      {'-','-','w'}},

                     {{'w','w','w'},
                      {'w','-','w'},
                      {'w','w','w'},
                      {'w','-','w'},
                      {'w','w','w'}},

                     {{'w','w','w'},
                      {'w','-','w'},
                      {'w','w','w'},
                      {'-','-','w'},
                      {'w','w','w'}}};

extern char Matrix[21][10] = 
                     {{'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'},
                      {'-','-','-','-','-','-','-','-','-','-'}}; //current Matrix

extern char pieces[28][4][4] = {
                                {{'-','-','-','-'}, // 0: O 1
                                 {'-','y','y','-'},
                                 {'-','y','y','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','-','-'}, // 1: O 2
                                 {'-','y','y','-'},
                                 {'-','y','y','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','-','-'}, // 2: O 3
                                 {'-','y','y','-'},
                                 {'-','y','y','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','-','-'}, // 3: O 4
                                 {'-','y','y','-'},
                                 {'-','y','y','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','b','-'}, // 4: I 1
                                 {'-','-','b','-'},
                                 {'-','-','b','-'},
                                 {'-','-','b','-'}},

                                {{'-','-','-','-'}, // 5:
                                 {'b','b','b','b'},
                                 {'-','-','-','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','b','-'}, // 6:
                                 {'-','-','b','-'},
                                 {'-','-','b','-'},
                                 {'-','-','b','-'}},

                                {{'-','-','-','-'}, // 7:
                                 {'b','b','b','b'},
                                 {'-','-','-','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','-','-'}, // 8: S 1
                                 {'-','-','r','r'},
                                 {'-','r','r','-'},
                                 {'-','-','-','-'}},

                                {{'-','r','-','-'}, // 9:
                                 {'-','r','r','-'},
                                 {'-','-','r','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','-','-'}, // 10:
                                 {'-','-','r','r'},
                                 {'-','r','r','-'},
                                 {'-','-','-','-'}},

                                {{'-','r','-','-'}, // 11:
                                 {'-','r','r','-'},
                                 {'-','-','r','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','-','-'}, // 12: Z 1
                                 {'g','g','-','-'},
                                 {'-','g','g','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','g','-'}, // 13:
                                 {'-','g','g','-'},
                                 {'-','g','-','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','-','-'}, // 14:
                                 {'g','g','-','-'},
                                 {'-','g','g','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','g','-'}, // 15:
                                 {'-','g','g','-'},
                                 {'-','g','-','-'},
                                 {'-','-','-','-'}},

                                {{'-','o','-','-'}, // 16: L 1
                                 {'-','o','-','-'},
                                 {'-','o','o','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','-','-'}, // 17:
                                 {'-','o','o','o'},
                                 {'-','o','-','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','-','-'}, // 18:
                                 {'-','o','o','-'},
                                 {'-','-','o','-'},
                                 {'-','-','o','-'}},

                                {{'-','-','-','-'}, // 19:
                                 {'-','-','o','-'},
                                 {'o','o','o','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','p','-'}, // 20: J 1
                                 {'-','-','p','-'},
                                 {'-','p','p','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','-','-'}, // 21:
                                 {'-','p','-','-'},
                                 {'-','p','p','p'},
                                 {'-','-','-','-'}},

                                {{'-','-','-','-'}, // 22:
                                 {'-','p','p','-'},
                                 {'-','p','-','-'},
                                 {'-','p','-','-'}},

                                {{'-','-','-','-'}, // 23:
                                 {'p','p','p','-'},
                                 {'-','-','p','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','-','-'}, // 24: T 1
                                 {'-','v','v','v'},
                                 {'-','-','v','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','v','-'}, // 25:
                                 {'-','v','v','-'},
                                 {'-','-','v','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','v','-'}, // 26:
                                 {'-','v','v','v'},
                                 {'-','-','-','-'},
                                 {'-','-','-','-'}},

                                {{'-','-','v','-'}, // 27:
                                 {'-','-','v','v'},
                                 {'-','-','v','-'},
                                 {'-','-','-','-'}}
                                                   };

bool nexttick = true;
